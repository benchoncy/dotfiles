#!/usr/bin/env bash
# Adapted from ThePrimeagen (https://github.com/ThePrimeagen/.dotfiles)
# Manages tmux sessions named by ticket/task number by default


if [[ $# -eq 1 ]]; then
    session_name=$1
else
    # if no session name, get ticket number
    session_name=$(jira-finder)
fi

if [[ -z $session_name ]]; then
    exit 0
fi

tmux_running=$(pgrep tmux)

# if not in a tmux session, create one
if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
    tmux new-session -s $session_name
    exit 0
fi

# if in a tmux session, create one and switch to it
if ! tmux has-session -t=$session_name 2> /dev/null; then
    tmux new-session -ds $session_name
    tmux-windowizer -s $session_name
    # Remove default window
    tmux swap-window -t $session_name:1 -s $session_name:2
    tmux kill-window -t $session_name:2
fi

tmux switch-client -t $session_name
